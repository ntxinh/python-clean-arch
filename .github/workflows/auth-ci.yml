name: Auth CI Pipeline

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  test-and-lint:
    name: Test and Lint
    runs-on: ubuntu-latest

    env:
      # Configure uv to use system python not needed here, 
      # but we want it to handle the specific version installation.
      UV_PYTHON: 3.12

    steps:
      # 1. Checkout the code
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. Install uv
      - name: Install uv
        uses: astral-sh/setup-uv@v5
        with:
          version: "latest"
          enable-cache: true
          cache-dependency-glob: "uv.lock"

      # 3. Install Python
      # uv will automatically download and install this version
      - name: Install Python
        run: uv python install ${{ env.UV_PYTHON }}

      # 4. Install Dependencies
      - name: Install dependencies
        run: |
          cd auth-api
          uv sync

      # 5. Linting (Ruff)
      # Checks for syntax errors and coding style violations
      # - name: Lint with Ruff
      #   run: |
      #     cd auth-api
      #     uv run ruff check .
      #     uv run ruff format --check .

      # 6. Run Tests
      # We skip this step if you haven't written tests yet, 
      # but it's ready for when you do.
      # - name: Run Tests
      #   # env:
      #   #   PYTHONPATH: .
      #   run: uv run pytest